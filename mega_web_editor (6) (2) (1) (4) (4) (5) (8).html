<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Mon OS</title>
<link rel="icon" href="Untitled Document 2.png" sizes="100%">

<!-- ‚úÖ Monaco Editor -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>

<style>
  body {
    margin: 0;
    background: #1e1e1e;
    color: white;
    font-family: 'Segoe UI', sans-serif;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }

  #toolbar {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 10px;
    background: #222;
    border-bottom: 1px solid #333;
  }

  #toolbar button {
    background: #333;
    border: none;
    color: white;
    padding: 6px 10px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
  }

  #toolbar button:hover {
    background: #444;
  }

  #currentFileLabel {
    margin-left: auto;
    opacity: 0.7;
  }

  #main {
    display: flex;
    flex: 1;
    overflow: hidden;
  }

  /* üìÅ Explorer */
  #explorer {
    width: 250px;
    background: #252526;
    border-right: 1px solid #333;
    overflow-y: auto;
    padding: 8px;
    transition: width 0.3s ease;
  }

  #explorer.collapsed {
    width: 0;
    padding: 0;
    overflow: hidden;
  }

  #explorer h3 {
    margin: 0 0 5px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  ul {
    list-style: none;
    padding-left: 16px;
  }

  li {
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  li:hover {
    background: #333;
  }

  .file-actions {
    display: flex;
    gap: 6px;
  }

  .file-actions span {
    cursor: pointer;
    color: #888;
  }

  .file-actions span:hover {
    color: #fff;
  }

  /* üñ• Panels */
  #panels {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: #1e1e1e;
  }

  .panel {
    display: none;
    width: 100%;
    height: 100%;
  }

  .panel.active {
    display: block;
  }

  #editor {
    width: 100%;
    height: calc(100% - 100px);
  }

  #editor {
    width: 100%;
    height: calc(100% - 100px);
  }

  #console {
    background: #111;
    color: #0f0;
    height: 100px;
    overflow-y: auto;
    padding: 5px;
    font-family: monospace;
  }

  #gameCanvas,
  #pixelCanvas,
  #dawCanvas {
    background: #111;
    width: 100%;
    height: 100%;
  }

  #pixelCanvas {
    image-rendering: pixelated;
    cursor: crosshair;
  }
</style>
</head>

<body>
  <!-- üß≠ Toolbar -->
  <div id="toolbar">
    <button onclick="toggleExplorer()">Toggle Explorer</button>
    <button onclick="openFolder()">Open Folder</button>
    <button onclick="newFile()">New File</button>
    <button onclick="showPanel('editor')">Editor</button>
    <button onclick="showPanel('game')">Game Engine</button>
    <button onclick="showPanel('art')">Pixel Art</button>
    <button onclick="showPanel('daw')">DAW</button>
    <button onclick="runFile()">‚ñ∂ Run</button>
    <button onclick="saveCurrentFile()">Save</button>
    <button onclick="showPanel('about')">about</button>
    <span id="currentFileLabel">No file loaded..</span>
  </div>

  <!-- üóÇ Main -->
  <div id="main">
    <div id="explorer">
      <h3>Explorer</h3>
      <ul id="explorerList"></ul>
    </div>

    <div id="panels">
      <div id="editorPanel" class="panel active">
        <div id="editor"></div>
        <div id="console"></div>
      </div>

      <div id="gamePanel" class="panel">
        <canvas id="gameCanvas"></canvas>
      </div>

      <div id="aboutPanel" class="panel">
        <h1>Mon OS is a solo project made by me, to make an alternative for vscode.dev</h1>
        <p1>It is fully open source, has NO bloat, and has the monaco as the frontend!</p1>
        <p1> It is also a game engine but i didnt work on that yet, it will become an IDE and a game engine</p1>
        <p1> just not right now sadly :(</p1>
        <p1> If you want to support the project by contributing it or making a fork and making your own stuff, go right ahead :D</p1>
        <p1> This is a FOSS program, so do whatever you want</p1>
      </div>

      <div id="artPanel" class="panel">
        <canvas id="pixelCanvas"></canvas>
      </div>

      <div id="dawPanel" class="panel">
        <canvas id="dawCanvas"></canvas>
      </div>
    </div>
  </div>

<script>
/* ---------------- Panel Handling ---------------- */
function showPanel(panel) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.getElementById(panel + 'Panel').classList.add('active');
}

/* ---------------- File System Access API ---------------- */
let currentFolderHandle = null;
let currentFileHandle = null;
let currentFileName = null;
const explorerList = document.getElementById("explorerList");
const currentFileLabel = document.getElementById("currentFileLabel");

async function openFolder() {
  try {
    currentFolderHandle = await window.showDirectoryPicker();
    explorerList.innerHTML = "";
    await loadFolder(currentFolderHandle, explorerList);
  } catch (e) {
    console.log("Folder selection canceled or denied.");
  }
}

async function loadFolder(dirHandle, ul) {
  ul.innerHTML = "";
  for await (const [name, handle] of dirHandle.entries()) {
    const li = document.createElement("li");
    const nameSpan = document.createElement("span");
    nameSpan.textContent = name;
    li.appendChild(nameSpan);

    if (handle.kind === "file") {
      li.onclick = async (e) => {
        if (e.target.classList.contains("delete")) return;
        await openFile(handle, name);
      };

      const actions = document.createElement("div");
      actions.classList.add("file-actions");
      const del = document.createElement("span");
      del.classList.add("delete");
      del.textContent = "X";
      del.onclick = async (e) => {
        e.stopPropagation();
        await handle.remove();
        await loadFolder(currentFolderHandle, explorerList);
      };
      actions.appendChild(del);
      li.appendChild(actions);
    } else {
      li.textContent = " " + name;
      const subUl = document.createElement("ul");
      li.appendChild(subUl);
      li.onclick = (e) => {
        e.stopPropagation();
        subUl.style.display =
          subUl.style.display === "none" ? "block" : "none";
      };
      await loadFolder(handle, subUl);
    }
    ul.appendChild(li);
  }
}

async function openFile(handle, name) {
  currentFileHandle = handle;
  currentFileName = name;
  const file = await handle.getFile();
  const text = await file.text();
  editor.setValue(text);
  setLanguage(name);
  currentFileLabel.textContent = name;
}

async function saveCurrentFile() {
  if (!currentFileHandle) return;
  const writable = await currentFileHandle.createWritable();
  await writable.write(editor.getValue());
  await writable.close();
  console.log("File saved:", currentFileName);
}

async function newFile() {
  if (!currentFolderHandle) return alert("Open a folder first!");
  const name = prompt("Enter new file name:");
  if (!name) return;
  const newHandle = await currentFolderHandle.getFileHandle(name, { create: true });
  await openFile(newHandle, name);
  await loadFolder(currentFolderHandle, explorerList);
}

async function deleteFile() {
  if (!currentFileHandle) return alert("No file selected!");
  await currentFolderHandle.removeEntry(currentFileName);
  editor.setValue("");
  currentFileLabel.textContent = "No file loaded";
  await loadFolder(currentFolderHandle, explorerList);
}

/* ---------------- Toggle Explorer ---------------- */
function toggleExplorer() {
  document.getElementById("explorer").classList.toggle("collapsed");
}

/* ---------------- Monaco Editor ---------------- */
require.config({
  paths: { vs: "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs" },
});
require(["vs/editor/editor.main"], function () {
  window.editor = monaco.editor.create(document.getElementById("editor"), {
    value: "",
    language: "javascript",
    theme: "vs-dark",
    automaticLayout: true,
  });
});

function setLanguage(name) {
  const ext = name.split(".").pop().toLowerCase();
  let lang = "plaintext";
  if (ext === "js") lang = "javascript";
  else if (ext === "html") lang = "html";
  else if (ext === "css") lang = "css";
  else if (ext === "json") lang = "json";
  else if (ext === "c" || ext === "h") lang = "c";
  monaco.editor.setModelLanguage(editor.getModel(), lang);
}

/* ---------------- Run & Console ---------------- */
function runFile() {
  if (!currentFileHandle || !currentFileName) return;
  saveCurrentFile();
  consoleEl.textContent = "";
  if (currentFileName.endsWith(".js")) {
    try {
      new Function("console", editor.getValue())(console);
    } catch (e) {
      console.log("Error:", e);
    }
  } else if (currentFileName.endsWith(".html")) {
    const w = window.open();
    w.document.write(editor.getValue());
  }
}

const consoleEl = document.getElementById("console");
const origLog = console.log;
console.log = (...args) => {
  origLog(...args);
  consoleEl.textContent += args.join(" ") + "\n";
};

/* ---------------- Resize canvases ---------------- */
window.addEventListener("resize", () => {
  ["gameCanvas", "pixelCanvas", "dawCanvas"].forEach((id) => {
    const c = document.getElementById(id);
    c.width = c.clientWidth;
    c.height = c.clientHeight;
  });
});
window.dispatchEvent(new Event("resize"));
</script>
</body>
</html>
